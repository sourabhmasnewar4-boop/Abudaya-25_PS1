{% extends "layouts/dashboard_layout.html" %}
{% block title %}Fulfillment Dashboard{% endblock %}
{% block sidebar_links %}
    {% set active_page = 'dashboard' %}
    {% include 'layouts/_admin_sidebar.html' %}
{% endblock %}
{% block content %}
<header class="mb-8">
    <h1 class="text-3xl font-bold text-slate-800">Fulfillment Dashboard</h1>
    <p class="text-slate-500 mt-1">Provision new patient cards and hospital scanners from pending orders.</p>
</header>
<div class="bg-white p-6 rounded-2xl shadow-lg">
    <h2 class="text-xl font-semibold text-slate-700 mb-4 border-b pb-4">Pending Orders</h2>
    <div class="space-y-4">
        {% for order in orders %}
        <div class="bg-slate-50 p-4 rounded-lg border border-slate-200">
            {% if order.order_type == 'patient_kit' %}
                <h3 class="font-bold text-indigo-700">Patient Kit Order #{{ order.id }}</h3>
                <div class="text-sm text-slate-600 mt-2">
                    <p><strong>Patient:</strong> {{ order.first_name }} {{ order.last_name }}</p>
                    <p><strong>Ship To:</strong> {{ order.shipping_address }}</p>
                </div>
                <form action="{{ url_for('provision_card', admin_id=admin.id) }}" method="POST" class="mt-3 flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="hidden" name="order_id" value="{{ order.id }}">
                    <input type="hidden" name="user_id" value="{{ order.user_id }}">
                    <input type="text" name="card_uid" placeholder="Enter Physical Card UID" class="input-field flex-grow" required>
                    <button type="submit" class="btn-primary w-full sm:w-auto">Assign & Ship Card</button>
                </form>
            {% else %}
                <h3 class="font-bold text-green-700">Scanner Kit Order #{{ order.id }}</h3>
                <div class="text-sm text-slate-600 mt-2">
                    <p><strong>Hospital:</strong> {{ order.hospital_name }}</p>
                    <p><strong>Ship To:</strong> {{ order.hospital_address }}</p>
                </div>
                <form action="{{ url_for('provision_scanner', admin_id=admin.id) }}" method="POST" class="mt-3 flex flex-col sm:flex-row items-center space-y-2 sm:space-y-0 sm:space-x-2">
                    <input type="hidden" name="order_id" value="{{ order.id }}">
                    <input type="hidden" name="hospital_id" value="{{ order.hospital_id }}">
                    <input type="text" name="activation_code" placeholder="Enter Code for Scanner Box" class="input-field flex-grow" required>
                    <button type="submit" class="btn-primary w-full sm:w-auto">Provision & Ship Scanner</button>
                </form>
            {% endif %}
        </div>
        {% else %}
        <p class="text-slate-500 italic text-center py-8">No pending orders.</p>
        {% endfor %}
    </div>
</div>
{% endblock %}
